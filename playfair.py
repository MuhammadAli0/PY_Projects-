import re

class PlayfairError(Exception):
        def __init__(self, message):
                    print message

                    class Playfair:
                            # omissionRule determines which omission rule you want to use (go figure). See the list at the beginning of the constructor
                                # doublePadding determines what letter you would like to use to pad a digraph that is double letters
                                    # endPadding determines what letter you would like to use to pad the end of an input containing an odd number of letters
                                        def __init__(self, omissionRule = 0, doublePadding = 'X', endPadding = 'X'):
                                                    omissionRules = [
                                                                        'Merge J into I',
                                                                                    'Omit Q',
                                                                                                'Merge I into J',
                                                                                                        ]
                                                            if omissionRule >= 0 and omissionRule < len(omissionRules):
                                                                            self.omissionRule = omissionRule
                                                                                    else:
                                                                                                    raise PlayfairError('Possible omission rule values are between 0 and ' + (len(omissionRules) - 1) + '.')
                                                                                                        
                                                                                                        # start with a blank password
                                                                                                                self.grid = self.generateGrid('')
                                                                                                                        
                                                                                                                                # make sure the input for the double padding character is valid
                                                                                                                                        if len(doublePadding) != 1:
                                                                                                                                                        raise PlayfairError('The double padding must be a single character.')
                                                                                                                                                            elif not self.isAlphabet(doublePadding):
                                                                                                                                                                            raise PlayfairError('The double padding must be a letter of the alphabet.')
                                                                                                                                                                                elif doublePadding not in self.grid:
                                                                                                                                                                                                raise PlayfairError('The double padding character must not be omitted by the omission rule.')
                                                                                                                                                                                                    else:
                                                                                                                                                                                                                    self.doublePadding = doublePadding.upper()
                                                                                                                                                                                                                            
                                                                                                                                                                                                                                    # make sure the input for the end padding character is valid 
                                                                                                                                                                                                                                            if len(endPadding) != 1:
                                                                                                                                                                                                                                                            raise PlayfairError('The end padding must be a single character.')
                                                                                                                                                                                                                                                                elif not self.isAlphabet(endPadding):
                                                                                                                                                                                                                                                                                raise PlayfairError('The end padding must be a letter of the alphabet.')
                                                                                                                                                                                                                                                                                    elif endPadding not in self.grid:
                                                                                                                                                                                                                                                                                                    raise PlayfairError('The end padding character must not be omitted by the omission rule.')
                                                                                                                                                                                                                                                                                                        else:
                                                                                                                                                                                                                                                                                                                        self.endPadding = endPadding.upper()
                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                # returns None if the letter should be discarded, else returns the converted letter
                                                                                                                                                                                                                                                                                                                                    def convertLetter(self, letter):
                                                                                                                                                                                                                                                                                                                                                if self.omissionRule == 0:
                                                                                                                                                                                                                                                                                                                                                                if letter == 'J':
                                                                                                                                                                                                                                                                                                                                                                                    letter = 'I'
                                                                                                                                                                                                                                                                                                                                                                                                return letter
                                                                                                                                                                                                                                                                                                                                                                                                    elif self.omissionRule == 1:
                                                                                                                                                                                                                                                                                                                                                                                                                    if letter == 'Q':
                                                                                                                                                                                                                                                                                                                                                                                                                                        letter = None
                                                                                                                                                                                                                                                                                                                                                                                                                                                    return letter
                                                                                                                                                                                                                                                                                                                                                                                                                                                        elif self.omissionRule == 2:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if letter == 'I':
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            letter = 'J'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return letter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            else:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            raise PlayfairError('The omission rule provided has not been configured properly.')
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # returns the alphabet used by the cipher (takes into account the omission rule)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                def getAlphabet(self):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            fullAlphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    alphabet = ''
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    for letter in fullAlphabet:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    letter = self.convertLetter(letter)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if letter is not None and letter not in alphabet:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    alphabet += letter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return alphabet
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    # generates the 25 character grid based on the omission rule and the given password
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        def generateGrid(self, password):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    grid = ''
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            alphabet = self.getAlphabet()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for letter in password:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if letter not in grid and letter in alphabet:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                grid += letter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                for letter in alphabet:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if letter not in grid:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    grid += letter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return grid
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    # splits the text input into digraphs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        def generateDigraphs(self, input):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    input = self.toAlphabet(input).upper()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            inputFixed = ''
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for i in range(len(input)):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            letter = self.convertLetter(input[i])
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if letter is not None:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            inputFixed += letter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            digraphs = []
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            counter = 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    while counter < len(inputFixed):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    digraph = ''
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if counter + 1 == len(inputFixed): # we have reached the end of the inputFixed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    digraph = inputFixed[counter] + self.endPadding
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    digraphs.append(digraph)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    break
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            elif inputFixed[counter] != inputFixed[counter + 1]: # we just need to create a normal digraph
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                digraph = inputFixed[counter] + inputFixed[counter + 1]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                digraphs.append(digraph)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                counter += 2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            else: # we have a double letter digraph, so we add the double padding
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                digraph = inputFixed[counter] + self.doublePadding
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                digraphs.append(digraph)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                counter += 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return digraphs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # encrypts a digraph using the defined grid
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    def encryptDigraph(self, input):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if len(input) != 2:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                raise PlayfairError('The digraph that is going to be encrypted must be exactly 2 characters long.')
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    elif not self.isUpper(input):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    raise PlayfairError('The digraph that is going to be
